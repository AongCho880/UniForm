generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Student {
  studentId String   @id @default(uuid())
  fullName  String   @db.VarChar(190)
  email     String   @unique
  phone     String?  @db.VarChar(15)
  password  String   @db.VarChar(255) // Ensure this field exists
  address   String?  @db.VarChar(300)
  role      String   @default("STUDENT") // Ensure role exists
  dob       DateTime
  profile   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  forms              Form[]
  AppliedInstitution AppliedInstitution[]
}

model Form {
  formId    String  @id @default(uuid())
  studentId String  @unique
  board     String
  reg       Int     @unique
  hscRoll   Int     @unique
  sscRoll   Int     @unique
  hscGPA    Float
  sscGPA    Float
  student   Student @relation(fields: [studentId], references: [studentId])
}

model Systemadmin {
  systemAdminId String   @id @default(uuid())
  email         String   @unique
  password      String   @db.VarChar(255)
  role          String   @default("SYSTEM_ADMIN")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now()) @updatedAt
}

model Admin {
  adminId   String   @id @default(uuid())
  email     String   @unique
  password  String   @db.VarChar(255)
  role      String   @default("INSTITUTION_ADMIN")
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  institutionId String?
  institution   Institution? @relation(fields: [institutionId], references: [institutionId])
}

model Institution {
  institutionId      String @id @default(uuid())
  name               String
  requirementsHscGPA Float
  requirementsSscGPA Float

  institutionCategoryInstitutionCategoryId String? @db.VarChar(255) // Foreign key to InstitutionCategory

  institutionForms   InstitutionForm[]
  AppliedInstitution AppliedInstitution[]

  admins Admin[] // Relation to Admin

  InstitutionCategory InstitutionCategory? @relation(fields: [institutionCategoryInstitutionCategoryId], references: [institutionCategoryId])
}

model InstitutionCategory {
  institutionCategoryId String @id @default(uuid())
  name                  String
  description           String

  institutions Institution[]
}

model InstitutionForm {
  institutionFormId String  @id @default(uuid())
  institutionId     String
  fieldName         String
  fieldType         String // e.g., "text", "number", "file"
  isRequired        Boolean @default(true)

  institution Institution @relation(fields: [institutionId], references: [institutionId])
}

model AppliedInstitution {
  id            String @id @default(uuid())
  studentId     String
  institutionId String

  student     Student     @relation(fields: [studentId], references: [studentId])
  institution Institution @relation(fields: [institutionId], references: [institutionId])
}
